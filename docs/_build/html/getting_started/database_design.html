<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Database Design and Table Structure &mdash; cmapdata 0.1.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=01f34227"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Compute Resources and Data Storage" href="compute_and_storage.html" />
    <link rel="prev" title="Installation and Setup" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            cmapdata
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation and Setup</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Database Design and Table Structure</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#variable-level-metadata">Variable Level Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dataset-level-metadata">Dataset Level Metadata</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="compute_and_storage.html">Compute Resources and Data Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="pitfalls.html">Pitfalls</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Dataset Ingestion Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../data_ingestion/web_validator.html">Web Validator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_ingestion/workflow.html">Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_ingestion/indexing_strategies.html">Table Creation and Indexing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_ingestion/data_validation.html">Data Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_ingestion/continuous_ingestion.html">Continuous Ingestion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_ingestion/gallery_examples/user_submitted_dataset_walkthrough.html">User Submitted Dataset Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_ingestion/gallery_examples/outside_small_dataset_walkthrough.html">Outside Small Dataset Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_ingestion/gallery_examples/outside_large_dataset_walkthrough.html">Outside Large Dataset Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_ingestion/gallery_examples/geotraces_walkthrough.html">Geotraces Seawater Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_ingestion/gallery_examples/eddy_walkthrough.html">Mesoscale Eddy Data Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_ingestion/gallery_examples/cruise_ingestion.html">Ingesting Cruise Metdata and Trajectory</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Package Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../subpackages/DB.html">DB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../subpackages/collect.html">collect</a></li>
<li class="toctree-l1"><a class="reference internal" href="../subpackages/process.html">process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../subpackages/ingest.html">ingest</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Future Improvements</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../future/code_changes.html">Code Changes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Ref</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../API/API_common.html">API Ref common.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/API_cruise.html">API Ref cruise.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/API_data.html">API Ref data.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/API_DB.html">API Ref DB.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/API_general.html">API Ref general.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/API_mapping.html">API Ref mapping.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/API_metadata.html">API Ref metadata.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/API_region_classifcation.html">API/API_region_classification.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/API_SQL.html">API Ref SQL.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/API_stats.html">API Ref stats.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/API_transfer.html">API Ref transfer.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/API_vault_structure.html">API Ref vault_structure.py</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">cmapdata</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Database Design and Table Structure</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/getting_started/database_design.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="database-design-and-table-structure">
<h1>Database Design and Table Structure<a class="headerlink" href="#database-design-and-table-structure" title="Link to this heading"></a></h1>
<figure class="align-default" id="id1">
<img alt="CMAP DB metadata specific table database diagram" src="../_images/SQL_diagram.png" />
<figcaption>
<p><span class="caption-text">CMAP DB metadata specific table database diagram</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Simons CMAP currently has three servers that contain near replicates of the SQL Server database. The names of these three are: Rainier, Mariana and Rossby.
Rainier was the first dedicated server to host the database and currently serves as the main ‘source of truth’.</p>
<p>In addition to the three SQL Servers there is a a Spark SQL Warehouse cluster with Apache Hive ANSI SQL:2003 interface. Its alias is: Cluster. This is used for large datasets (i.e. satellite data and Darwin) or large, continuously updated datasets (i.e. Argo data).</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Rainier is currently the production database and ‘source of truth’. If you want to test features, use Mariana or Rossby.</p>
</div>
<p>Data tables along with metadata tables are stored in the same schema. Common queries live on the database as stored procedures.
Data tables are independent of one another. The dataset table name is stored as a column in the metadata table <em>tblVariables</em>.
This key links the data tables to the rest of the metadata.</p>
<p>Metadata tables are listed below with a brief description of each:</p>
<section id="variable-level-metadata">
<h2>Variable Level Metadata<a class="headerlink" href="#variable-level-metadata" title="Link to this heading"></a></h2>
<p><strong>tblVariables</strong> links the data tables to the metadata through the column [Table_Name].
Columns with an _ID suffix are linked to other metadata tables. For example, Dataset level information in tblDatasets in linked through [Dataset_ID].
Each data variable in a dataset has a row in this table, containing the following columns:</p>
<ul class="simple">
<li><p>ID</p></li>
<li><p>DB</p></li>
<li><p>Dataset_ID</p></li>
<li><p>Table_Name</p></li>
<li><p>Short_Name</p></li>
<li><p>Long_Name</p></li>
<li><p>Unit</p></li>
<li><p>Temporal_Res_ID</p></li>
<li><p>Spatial_Res_ID</p></li>
<li><p>Temporal_Coverage_Begin</p></li>
<li><p>Temporal_Coverage_End</p></li>
<li><p>Lat_Coverage_Begin</p></li>
<li><p>Lat_Coverage_End</p></li>
<li><p>Lon_Coverage_Begin</p></li>
<li><p>Lon_Coverage_End</p></li>
<li><p>Grid_Mapping</p></li>
<li><p>Make_ID</p></li>
<li><p>Sensor_ID</p></li>
<li><p>Process_ID</p></li>
<li><p>Study_Domain_ID</p></li>
<li><p>Comment</p></li>
<li><p>Visualize</p></li>
<li><p>Data_Type</p></li>
<li><p>Org_ID</p></li>
<li><p>Conversion_Coefficient</p></li>
<li><p>Has_Depth</p></li>
</ul>
<p><strong>tblOrganism</strong> contains the organism name and the Organism_ID connects to Org_ID in tblVariables for a variable describing organism abundance. Additional tables related to the organism identification project are: <strong>tblOrgTaxon</strong>, <strong>tblOrgTrophic_Level</strong>, <strong>tblOrgSubtrophics</strong>, <strong>tblOrgTrophics</strong>, <strong>tblOrgSize_Image_Bigelow</strong>, <strong>tblOrgFunctional_Group_WORMS</strong>, <strong>tblOrgParaphyletic_Group_WORMS</strong>, <strong>tblOrgUnicellularity_WORMS</strong>. Details on the project can be found in Jira Epic 8 (<a class="reference external" href="https://simonscmap.atlassian.net/browse/CMAP-8">https://simonscmap.atlassian.net/browse/CMAP-8</a>)</p>
<p><strong>tblKeywords</strong> contains user submitted keywords used in the searching of a variable.
tblKeywords contains an ID column, where each value which corresponds to a unique variable entry in tblVariables.</p>
<ul class="simple">
<li><p>var_ID</p></li>
<li><p>keywords</p></li>
</ul>
<p><strong>tblTemporal_Resolution</strong>, <strong>tblSpatial_Resolution</strong>, <strong>tblMake</strong>, <strong>tblSensor</strong>, <strong>tblProcess_Stages</strong>, and <strong>tblStudy_Domains</strong> are all variable level tables that contain links between the ID’s in tblVariables and their respective tables.</p>
<p><strong>tblVariables_JSON_Metadata</strong> contains additional variable metadata that is unstructured to allow users to include any information that does not fall within the information in tblVariables.</p>
<p>For details on the unstructured metadata project see Jira the following tickets: (<a class="reference external" href="https://simonscmap.atlassian.net/browse/CMAP-563">https://simonscmap.atlassian.net/browse/CMAP-563</a>, <a class="reference external" href="https://simonscmap.atlassian.net/browse/CMAP-572">https://simonscmap.atlassian.net/browse/CMAP-572</a>). Each unstructured metadata object includes a value array and a description array. Values and descriptions are always arrays, even if empty or single values. Also, these arrays must always have identical lengths, even if descriptions are empty strings. Descriptions are meant to be human readable, short descriptions akin to alt-text for an image online. A single variable may have multiple entries in tblVariables_JSON_Metadata. An example of a variable-level unstructured metadata is:</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="err">{</span><span class="ss">&quot;cruise_names&quot;</span><span class="p">:</span><span class="err">{</span><span class="ss">&quot;values&quot;</span><span class="p">:[</span><span class="ss">&quot;PS71&quot;</span><span class="p">],</span><span class="ss">&quot;descriptions&quot;</span><span class="p">:[</span><span class="ss">&quot;Operators Cruise Name&quot;</span><span class="p">]</span><span class="err">}</span><span class="p">,</span><span class="ss">&quot;meta_links&quot;</span><span class="p">:</span><span class="err">{</span><span class="ss">&quot;values&quot;</span><span class="p">:[</span><span class="ss">&quot;https://www.bodc.ac.uk/data/documents/nodb/285421/&quot;</span><span class="p">],</span><span class="ss">&quot;descriptions&quot;</span><span class="p">:[</span><span class="ss">&quot;BODC documentation link&quot;</span><span class="p">]</span><span class="err">}}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As of September 2023 the only dataset with unstructured metadata is Geotraces Seawater IDP2021v2. Argo Core and Argo BGC are both good candidates for including unstructured metadata.</p>
</div>
</section>
<section id="dataset-level-metadata">
<h2>Dataset Level Metadata<a class="headerlink" href="#dataset-level-metadata" title="Link to this heading"></a></h2>
<p><strong>tblDatasets</strong> contains dataset level information and has links to tblVariables as well as links to cruise and region level information.</p>
<ul class="simple">
<li><p>ID</p></li>
<li><p>DB</p></li>
<li><p>Dataset_Name</p></li>
<li><p>Dataset_Long_Name</p></li>
<li><p>Variables</p></li>
<li><p>Data_Source</p></li>
<li><p>Distributor</p></li>
<li><p>Description</p></li>
<li><p>Climatology</p></li>
<li><p>Acknowledgement</p></li>
<li><p>Doc_URL</p></li>
<li><p>Icon_URL</p></li>
<li><p>Contact_Email</p></li>
<li><p>Dataset_Version</p></li>
<li><p>Dataset_Release_Date</p></li>
<li><p>Dataset_History</p></li>
</ul>
<p><strong>tblDataset_References</strong> holds references associated with the dataset, typically a DOI, paper citation, or website. References that are true DOIs with data frozen in time are linked by Reference_ID to <strong>tblDataset_DOI_Download</strong>. This table is used for automating the download of DOI data (DOI_Download_Link) and includes a flag for whether the DOI download is the CMAP template used for submission via the validator (CMAP_Format)</p>
<p><strong>tblDataset_Vault</strong> contains the relative path to the dataset leaf directory as well as a public link to the dataset leaf directory (read-only permission). In the future this may be joined to the catalog.</p>
<p><strong>tblDataset_Servers</strong> holds the alias names of each server the dataset can be found on. This was implemented to allow for replication across some but not all servers, and free up space on Rainier.</p>
<p><strong>Cruise Metadata</strong>
The metadata for cruises in CMAP is separated into multiple tables. A core <strong>tblCruise</strong> links
together metadata tables for cruise trajectories, cruise keywords, cruise region links and cruise dataset links.
<strong>tblDataset_Cruises</strong> is the linking table to connect cruise_IDs with dataset_IDs.</p>
<p><strong>Region Metadata</strong>
The region tables in CMAP share a similar schema to the cruise tables layout. <strong>tblRegions</strong> contains the ocean regions
(this can be expanded).
<strong>tblDataset_Regions</strong> is similar to <strong>tblDataset_Cruises</strong> because it acts as the linking table between the region and dataset tables.
<strong>tblCruise_Regions</strong> is a linking table between cruise IDs and region IDs.</p>
<p><strong>tblDatasets_JSON_Metadata</strong> contains additional dataset metadata that is unstructured to allow users to include any information that does not fall within the information in tblDatasets.</p>
<p>For details on the unstructured metadata project see Jira the following tickets: (<a class="reference external" href="https://simonscmap.atlassian.net/browse/CMAP-563">https://simonscmap.atlassian.net/browse/CMAP-563</a>, <a class="reference external" href="https://simonscmap.atlassian.net/browse/CMAP-572">https://simonscmap.atlassian.net/browse/CMAP-572</a>). As with the variable-level unstructured metadata, ach unstructured metadata object for datasets includes a value array and a description array. Values and descriptions are always arrays, even if empty or single values. Also, these arrays must always have identical lengths, even if descriptions are empty strings. Descriptions are meant to be human readable, short descriptions akin to alt-text for an image online. A dataset may have multiple entries in tblDatasets_JSON_Metadata. An example of a dataset-level unstructured metadata is:</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="err">{</span><span class="ss">&quot;publication_link&quot;</span><span class="p">:</span><span class="err">{</span><span class="ss">&quot;values&quot;</span><span class="p">:[</span><span class="ss">&quot;https://www.geotraces.org/geotraces-publications-database/&quot;</span><span class="p">],</span><span class="ss">&quot;descriptions&quot;</span><span class="p">:[</span><span class="ss">&quot;Link to database of GEOTRACES publications&quot;</span><span class="p">]</span><span class="err">}}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As of September 2023 the only dataset with unstructured metadata is Geotraces Seawater IDP2021v2. Argo Core and Argo BGC are both good candidates for including unstructured metadata.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Diana Haring.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>