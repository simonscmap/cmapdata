

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Workflow &mdash; cmapdata 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Pitfalls" href="pitfalls.html" />
    <link rel="prev" title="Web Validator" href="web_validator.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> cmapdata
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Ingesting a Dataset</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation and Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="database_design.html">Database Design and Table Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="compute_and_storage.html">Compute Resources and Data Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_validator.html">Web Validator</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Workflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#user-submitted-datasets">User Submitted Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#outside-small-datasets">Outside ‘Small’ Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#outside-large-datasets">Outside ‘Large’ Datasets</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pitfalls.html">Pitfalls</a></li>
</ul>
<p class="caption"><span class="caption-text">Package Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../subpackages/DB.html">DB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../subpackages/collect.html">collect</a></li>
<li class="toctree-l1"><a class="reference internal" href="../subpackages/process.html">process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../subpackages/ingest.html">ingest</a></li>
</ul>
<p class="caption"><span class="caption-text">Future Improvements</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../future/code_changes.html">Code Changes</a></li>
</ul>
<p class="caption"><span class="caption-text">API Ref</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../API/API_common.html">API Ref common.py</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">cmapdata</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Workflow</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/data_ingestion/workflow.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="workflow">
<h1>Workflow<a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h1>
<p>The process for ingesting datasets into CMAP differs based on a few factors.
The three main cateogries are <em>User Submitted Datasets</em>, <em>Outside ‘Small’ Datasets</em> and <em>Outside ‘Large’ Datasets</em>.
User submitted datasets that pass through the web validator must be &lt;150MB.
<em>Outside ‘Small’ Datasets</em> are datasets collected that are collected from an outside source that can generally fit in memory. An example would be an AMT or HOT dataset.
<em>Outside ‘Large’ Datasets</em> are datasets collected from an outside source that have multiple data files and cannot fit into memory. Examples are satellite data, model data or large insitu collections such as ARGO or GOSHIP.</p>
<div class="section" id="user-submitted-datasets">
<h2>User Submitted Datasets<a class="headerlink" href="#user-submitted-datasets" title="Permalink to this headline">¶</a></h2>
<p>User submitted datasets are submitted through the web validator. Once the QA/QC checks are completed and a DOI is recieved, the dataset can be ingested into CMAP.
Starting out with the dataset in ‘/CMAP Data Submission Dropbox/Simons CMAP/staging/combined/{dataset_name}.xlsx, the data ingestion pipeline should work.</p>
<p>Using general.py, you can pass command line arguments to specify which server you wish to add the dataset to as well as including a DOI.</p>
<p>Where we have:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">general</span><span class="o">.</span><span class="n">py</span> <span class="p">{</span><span class="n">table_name</span><span class="p">}</span> <span class="p">{</span><span class="n">branch</span><span class="p">}</span> <span class="p">{</span><span class="n">filename</span><span class="p">}</span> <span class="p">{</span><span class="o">-</span><span class="n">d</span><span class="p">}</span> <span class="p">{</span><span class="n">DOI</span> <span class="n">link</span><span class="p">}</span> <span class="p">{</span><span class="o">-</span><span class="n">S</span><span class="p">}</span> <span class="p">{</span><span class="n">server</span><span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>{<strong>branch</strong>}: Branch where dataset should be placed in Vault. Ex’s: cruise, float, station, satellite, model, assimilation]</p></li>
<li><p>{<strong>filename</strong>}: Base file name in vault/staging/combined/. Ex.: ‘global_diazotroph_nifH.xlsx’</p></li>
<li><p>{<strong>-d</strong>}: Optional flag for including DOI with dataset in tblReferences. DOI link string follows flag arg.</p></li>
<li><p>{<strong>DOI link</strong>}: String for full web address of CMAP specific DOI. Ex. “<a class="reference external" href="http://doi.org/10.5281/zenodo.4968554">http://doi.org/10.5281/zenodo.4968554</a>”</p></li>
<li><p>{<strong>-S</strong>}: Required flag for specifying server choice. Server name string follows flag.</p></li>
<li><p>{<strong>server</strong>}: Valid server name string.  Ex. “Rainier”, “Mariana” or “Rossby”</p></li>
</ul>
<p>An example string would be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">general</span><span class="o">.</span><span class="n">py</span> <span class="n">tblglobal_diazotroph_nifH</span> <span class="n">cruise</span> <span class="s1">&#39;global_diazotroph_nifH.xlsx&#39;</span> <span class="o">-</span><span class="n">d</span> <span class="s2">&quot;http://doi.org/10.5281/zenodo.4968554&quot;</span> <span class="o">-</span><span class="n">S</span> <span class="s2">&quot;Rainier&quot;</span>
</pre></div>
</div>
<p>general.py contains wrapper functions that will split the excel sheet into pandas dataframes, transfer the data to vault/, build a suggested SQL table, insert data, split dataset_meta_data and vars_meta_data into SQL queries and insert into SQL metadata tables, build summary statistics, match provided cruises to cruises in the database, classify the dataset into ocean regions and create maps and icons for the web catalog.</p>
<p>Once the dataset has been successfully ingested (appears in the web catalog and can be visualized), it should be ingested on the other servers.</p>
</div>
<div class="section" id="outside-small-datasets">
<h2>Outside ‘Small’ Datasets<a class="headerlink" href="#outside-small-datasets" title="Permalink to this headline">¶</a></h2>
<p>These datasets usually need quite a bit of data munging to make them match the CMAP data format. Additionally, metadata needs to be collected and created.
To keep a record of data transformations, any processing scripts should be placed in <strong>/process/../process_datasetname.py</strong>. Additionally, any relevent collection information should be placed in <strong>/collect/../collect_datasetname.py</strong></p>
</div>
<div class="section" id="outside-large-datasets">
<h2>Outside ‘Large’ Datasets<a class="headerlink" href="#outside-large-datasets" title="Permalink to this headline">¶</a></h2>
<p>These datasets are usually composed of multiple data files (generally in netcdf or hdf5). Some features of the ingestion pipeline only work for data that can fit into memory. Because of this, special care is needed to ingest these large datasets.
Data usually starts in the /collect/ step. Depending on the source, data is downloaded using curl/wget/ftp etc. into <strong>vault/collected_data/dataset_name/rep/*files/</strong>. Any collection scripts should be stored in <strong>/collect/../{collect_datasetname.py}.
Once data has been transfered, the next step is any data processing. This should be recorded in **/process/../process_datasetname.py</strong>.</p>
<p>In this data processing script, data should be read from <strong>/collected_data/</strong>, cleaned, sorted and inserted into the database(s).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You will need to create a SQL table and add it to the databases prior to ingestion. Any SQL table creation script should be recorded in DB/ (repository is on Simons CMAP github). Adding indexes once the ingestion has completed might speed up ingestion.</p>
</div>
<p>After the data has been inserted and the indicies successfully created, metadata will need to be created and added to the databases. A standard excel template should be used for the dataset and vars metadata sheets.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2021, Norland Raphael Hagen

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>