

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Outside Small Dataset Walkthrough &mdash; cmapdata 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/style.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Outside Large Dataset Walkthrough" href="outside_large_dataset_walkthrough.html" />
    <link rel="prev" title="User Submitted Dataset Walkthrough" href="user_submitted_dataset_walkthrough.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> cmapdata
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/installation.html">Installation and Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/database_design.html">Database Design and Table Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/compute_and_storage.html">Compute Resources and Data Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/pitfalls.html">Pitfalls</a></li>
</ul>
<p class="caption"><span class="caption-text">Dataset Ingestion Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../web_validator.html">Web Validator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow.html">Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_submitted_dataset_walkthrough.html">User Submitted Dataset Walkthrough</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Outside Small Dataset Walkthrough</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#collecting-a-small-dataset-from-an-ftp-site-using-wget">Collecting a small dataset from an FTP site using wget</a></li>
<li class="toctree-l2"><a class="reference internal" href="#processing-a-small-dataset">Processing a small dataset</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="outside_large_dataset_walkthrough.html">Outside Large Dataset Walkthrough</a></li>
</ul>
<p class="caption"><span class="caption-text">Package Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../subpackages/DB.html">DB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../subpackages/collect.html">collect</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../subpackages/process.html">process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../subpackages/ingest.html">ingest</a></li>
</ul>
<p class="caption"><span class="caption-text">Future Improvements</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../future/code_changes.html">Code Changes</a></li>
</ul>
<p class="caption"><span class="caption-text">API Ref</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../API/API_common.html">API Ref common.py</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">cmapdata</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Outside Small Dataset Walkthrough</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/data_ingestion/gallery_examples/outside_small_dataset_walkthrough.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="outside-small-dataset-walkthrough">
<h1>Outside Small Dataset Walkthrough<a class="headerlink" href="#outside-small-dataset-walkthrough" title="Permalink to this headline">¶</a></h1>
<p>Datasets from outside sources do not follow CMAPs data guidelines and vary drastically in quality of metadata.
Many dataset have variables that are not self explanatory and may have data flags or conventions that will take some work to understand.
One of the best resources is the rest of the Armbrust lab, which has tons of oceanography domain knowledge and experience working with these datasets.
Additionally, contacting the dataset owner/provider can also provide insight.</p>
<p>In this example, we are going to walkthrough collecting, processing and ingesting a small outside dataset into CMAP.</p>
<p>Recently, we wanted to add multiple datasets from the CMORE-BULA cruise that traveled from Hawaii south to Fiji.
These data were available on the HOT (Hawaii Ocean Time-series) FTP site.</p>
<div class="section" id="collecting-a-small-dataset-from-an-ftp-site-using-wget">
<h2>Collecting a small dataset from an FTP site using wget<a class="headerlink" href="#collecting-a-small-dataset-from-an-ftp-site-using-wget" title="Permalink to this headline">¶</a></h2>
<p>From the UH CMORE-BULA site: <a class="reference external" href="https://hahana.soest.hawaii.edu/cmorebula/cmorebula.html">https://hahana.soest.hawaii.edu/cmorebula/cmorebula.html</a> there are links for data access.
Each of these leads you to an FTP site.</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../_images/cmore_bula_data_link.png"><img alt="CMORE-BULA" src="../../_images/cmore_bula_data_link.png" style="width: 379.20000000000005px; height: 212.8px;" /></a>
</div>
<p>The FTP site for the CMORE-BULA CTD dataset contains 46 individual CTD casts.
Instead of downloading them all by hand, we can use some functionality from the wget command line tool.</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../_images/cmore_bula_ctd_ftp.png"><img alt="CMORE-BULA" src="../../_images/cmore_bula_ctd_ftp.png" style="width: 464.0px; height: 628.8000000000001px;" /></a>
</div>
<p>To keep a record of dataset processing, it is a good idea to create a collect_{dataset_name}.py script in the collect/ submodule of cmapdata.
For this example, we have created a directory with the tree structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── insitu
    ├── cruise
        ├── misc_cruise
            ├── KM0704_CMORE_BULA
                └── collect_KM0704_CMORE_BULA.py
</pre></div>
</div>
<p>For each dataset in this cruise (CTD, underway, underway sample, bottle  &amp; wind), we can collect any files using wget.</p>
<p>For CTD we can write a download function using wget and pass the FTP link for the CTD files. Using wget, we can specify the output directory.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">odir</span> <span class="o">=</span> <span class="n">vs</span><span class="o">.</span><span class="n">collected_data</span> <span class="o">+</span> <span class="s2">&quot;insitu/cruise/misc_cruise/KM0704_CMORE_BULA/&quot;</span>

<span class="k">def</span> <span class="nf">download_KM0704_data</span><span class="p">(</span><span class="n">outputdir</span><span class="p">,</span> <span class="n">download_link</span><span class="p">):</span>
    <span class="n">wget_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;wget -P &#39;</span><span class="si">{outputdir}</span><span class="s2">&#39; -np -R &quot;&#39;index.html*&quot; robots=off -nH --cut-dirs 8 -r  </span><span class="si">{download_link}</span><span class="s2">&quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">wget_str</span><span class="p">)</span>

<span class="c1"># #download ctd</span>
<span class="n">download_KM0704_data</span><span class="p">(</span>
    <span class="n">odir</span> <span class="o">+</span> <span class="s2">&quot;CTD/&quot;</span><span class="p">,</span> <span class="s2">&quot;https://hahana.soest.hawaii.edu/FTP/cmore/ctd/bula1/&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>For all the datasets in CMORE-BULA, this process would need to be repeated.</p>
</div>
<div class="section" id="processing-a-small-dataset">
<h2>Processing a small dataset<a class="headerlink" href="#processing-a-small-dataset" title="Permalink to this headline">¶</a></h2>
<p>Now that the CTD files have been collected, we can begin processing them.
Once again, we are going to create a dataset/collection specific file for a record. In this example, we will call it process_KM0704_CMORE_BULA.py
This should be placed in the <strong>collect/</strong> submodule of cmapdata.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── insitu
    ├── cruise
        ├── misc_cruise
            ├── KM0704_CMORE_BULA
                └── process_KM0704_CMORE_BULA.py
</pre></div>
</div>
<p>The full CTD processing steps can be found in this file, but in summary they are:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Use the glob library to create a list of all .ctd files collected previously.</p></li>
<li><p>Iterate thorough list</p>
<ul class="simple">
<li><p>read csv into pandas dataframe</p></li>
<li><p>replace ‘-9’ missing values with np.nan</p></li>
<li><p>extract station,cast,cast direction and num_observations from filename using string splitting.</p></li>
<li><p>create new columns of variable specific quality flags out of strange combined flag column.</p></li>
<li><p>drop unneeded columns</p></li>
<li><p>append data</p></li>
</ul>
</li>
<li><p>concatenate cleaned data into Pandas Dataframe</p></li>
</ol>
</div></blockquote>
<p>Other datasets in the CMORE-BULA cruise required additional processing. Some required time and depth formatting.
Others were missing spatio-temporal coordinates, which had to be collected using spatial or station/cast # joins to the other datasets.</p>
<p>Once all the data are processed, the can be exported to dropbox/../vault/staging/combined/ where dataset and variable metadata sheets can be added. Once these are complete, the dataset should run through the validator.
From here, follow the steps outlined in the <strong>user submitted datasets walkthrough</strong> section to ingest the data into the database.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2021, Norland Raphael Hagen

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>