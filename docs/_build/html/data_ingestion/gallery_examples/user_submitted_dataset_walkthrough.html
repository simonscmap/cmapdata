<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Submitted Dataset Walkthrough &mdash; cmapdata 0.0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=d45e8c67"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Outside Small Dataset Walkthrough" href="outside_small_dataset_walkthrough.html" />
    <link rel="prev" title="Table Creation and Indexing" href="../indexing_strategies.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            cmapdata
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/installation.html">Installation and Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/database_design.html">Database Design and Table Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/compute_and_storage.html">Compute Resources and Data Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/pitfalls.html">Pitfalls</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Dataset Ingestion Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../web_validator.html">Web Validator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow.html">Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../indexing_strategies.html">Table Creation and Indexing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User Submitted Dataset Walkthrough</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#removal-of-previously-existing-dataset">Removal of Previously Existing Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="#specifying-the-ingestion-arguments">Specifying the Ingestion Arguments</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="outside_small_dataset_walkthrough.html">Outside Small Dataset Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="outside_large_dataset_walkthrough.html">Outside Large Dataset Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="cruise_ingestion.html">Ingesting Cruise Metdata and Trajectory</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Package Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../subpackages/DB.html">DB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../subpackages/collect.html">collect</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../subpackages/process.html">process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../subpackages/ingest.html">ingest</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Future Improvements</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../future/code_changes.html">Code Changes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Ref</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../API/API_common.html">API Ref common.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../API/API_cruise.html">API Ref cruise.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../API/API_data.html">API Ref data.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../API/API_DB.html">API Ref DB.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../API/API_general.html">API Ref general.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../API/API_mapping.html">API Ref mapping.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../API/API_metadata.html">API Ref metadata.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../API/API_region_classifcation.html">API/API_region_classification.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../API/API_SQL.html">API Ref SQL.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../API/API_stats.html">API Ref stats.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../API/API_transfer.html">API Ref transfer.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../API/API_vault_structure.html">API Ref vault_structure.py</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">cmapdata</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">User Submitted Dataset Walkthrough</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/data_ingestion/gallery_examples/user_submitted_dataset_walkthrough.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="user-submitted-dataset-walkthrough">
<h1>User Submitted Dataset Walkthrough<a class="headerlink" href="#user-submitted-dataset-walkthrough" title="Link to this heading"></a></h1>
<p>This example should walk you through the steps of ingesting a user submitted dataset into the database.</p>
<p>For this example, we are going to be using the dataset: <strong>Falkor_2018 - 2018 SCOPE Falkor Cruise Water Column Data</strong></p>
<section id="removal-of-previously-existing-dataset">
<h2>Removal of Previously Existing Dataset<a class="headerlink" href="#removal-of-previously-existing-dataset" title="Link to this heading"></a></h2>
<p>This dataset was an early submitted dataset and has recently been revised to bring it up to line with the current CMAP data submission guidelines. The dataset was reviewed by CMAP data curators, which means the finalized updated dataset will be found in the /final folder <strong>Dropbox/Apps/&lt;dataset_short_name&gt;/final</strong></p>
<p>Because this dataset already exists in the database, we must first remove the old version.</p>
<p>To do this, we can use some of the functionality in cmapdata/ingest/metadata.py</p>
<p>By calling this function <strong>deleteCatalogTables(tableName, db_name, server)</strong>, we can remove any metadata and data tables from a given server.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This function has drop privileges! Make sure you want to wipe the dataset metadata and table.</p>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">python metadata.py</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">deleteCatalogTables</span><span class="p">(</span><span class="s1">&#39;tblFalkor_2018&#39;</span><span class="p">,</span><span class="s1">&#39;Rainier&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Continue this function for any other existing servers. ex. ‘Mariana’, ‘Rossby’</p>
<p>If only the metadata needs updating, calling the function <strong>deleteTableMetadata(tableName, db_name, server)</strong> will remove all metadata associated with the dataset, but will not delete the data table.</p>
</section>
<section id="specifying-the-ingestion-arguments">
<h2>Specifying the Ingestion Arguments<a class="headerlink" href="#specifying-the-ingestion-arguments" title="Link to this heading"></a></h2>
<p>Using ingest/general.py, you can pass command line arguments to specify which server you wish to add the dataset to as well as including a DOI. Because the DOI is a CMAP template, the optional flag -t is not necessary to include as the default is true.</p>
<p>Navigate to the ingest/ submodule of cmapdata. From there, run the following in the terminal.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">general</span><span class="o">.</span><span class="n">py</span> <span class="p">{</span><span class="n">table_name</span><span class="p">}</span> <span class="p">{</span><span class="n">branch</span><span class="p">}</span> <span class="p">{</span><span class="n">filename</span><span class="p">}</span> <span class="p">{</span><span class="o">-</span><span class="n">d</span><span class="p">}</span> <span class="p">{</span><span class="n">DOI</span> <span class="n">link</span><span class="p">}</span> <span class="p">{</span><span class="o">-</span><span class="n">l</span><span class="p">}</span> <span class="p">{</span><span class="n">DOI</span> <span class="n">download</span> <span class="n">link</span><span class="p">}</span> <span class="p">{</span><span class="o">-</span><span class="n">f</span><span class="p">}</span> <span class="p">{</span><span class="n">DOI</span> <span class="n">file</span> <span class="n">name</span><span class="p">}</span> <span class="p">{</span><span class="o">-</span><span class="n">S</span><span class="p">}</span> <span class="p">{</span><span class="n">server</span><span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>{<strong>branch</strong>}: Branch where dataset should be placed in Vault. Ex’s: cruise, float, station, satellite, model, assimilation</p></li>
<li><p>{<strong>filename</strong>}: Base file name in vault/staging/combined/. Ex.: ‘Falkor_2018.xlsx’</p></li>
<li><p>{<strong>-d</strong>}: Optional flag for including DOI with dataset in tblReferences. DOI link string follows flag arg.</p></li>
<li><p>{<strong>DOI link</strong>}: String for full web address of CMAP specific DOI. Ex. “<a class="reference external" href="https://doi.org/10.5281/zenodo.5208854">https://doi.org/10.5281/zenodo.5208854</a>”</p></li>
<li><p>{<strong>-l</strong>}: Optional flag for including the DOI download link in tblDataset_DOI_Download. DOI dowload link string follows flag.</p></li>
<li><p>{<strong>DOI download link</strong>}: String for DOI download link of CMAP specific DOI. Ex. “<a class="reference external" href="https://zenodo.org/record/5208854/files/tblFalkor_2018%20%282%29.xlsx?download=1">https://zenodo.org/record/5208854/files/tblFalkor_2018%20%282%29.xlsx?download=1</a>”</p></li>
<li><p>{<strong>-f</strong>}:  Optional flag for DOI file name. DOI file name string follows flag.</p></li>
<li><p>{<strong>DOI file name</strong>}:  String for filename of CMAP specific DOI. Ex. “tblFalkor_2018 (2).xlsx”</p></li>
<li><p>{<strong>-t</strong>}: Optional flag for denoting if DOI is a web validator template. Default value is 1.</p></li>
<li><p>{<strong>DOI in CMAP template</strong>}:  Boolean if DOI is a web validator template.</p></li>
<li><p>{<strong>-S</strong>}: Required flag for specifying server choice. Server name string follows flag.</p></li>
<li><p>{<strong>server</strong>}: Valid server name string.  Ex. “Rainier”, “Mariana” or “Rossby”</p></li>
</ul>
<p>An example string for full ingest would be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">general</span><span class="o">.</span><span class="n">py</span> <span class="n">tblFalkor_2018</span> <span class="n">cruise</span> <span class="s1">&#39;Falkor_2018.xlsx&#39;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;https://doi.org/10.5281/zenodo.5208854&#39;</span> <span class="o">-</span><span class="n">l</span> <span class="s1">&#39;https://zenodo.org/record/5208854/files/tblFalkor_2018</span><span class="si">%20%</span><span class="s1">282%29.xlsx?download=1&#39;</span> <span class="o">-</span><span class="n">f</span> <span class="s1">&#39;tblFalkor_2018 (2).xlsx&#39;</span> <span class="o">-</span><span class="n">S</span> <span class="s1">&#39;Rainier&#39;</span>
</pre></div>
</div>
<p>There are two additional arguments if you are only updating the metadata, and not reingesting the data table.
* {<strong>-U</strong>}: Optional flag for specifying updates to metadata only
* {<strong>-F</strong>}: Optional boolean depth flag. Default value is 0. Set to 1 if the data has a depth column</p>
<p>An example string for metadata update would be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">general</span><span class="o">.</span><span class="n">py</span> <span class="n">tblFalkor_2018</span> <span class="n">cruise</span> <span class="s1">&#39;Falkor_2018.xlsx&#39;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;https://doi.org/10.5281/zenodo.5208854&#39;</span> <span class="o">-</span><span class="n">l</span> <span class="s1">&#39;https://zenodo.org/record/5208854/files/tblFalkor_2018</span><span class="si">%20%</span><span class="s1">282%29.xlsx?download=1&#39;</span> <span class="o">-</span><span class="n">f</span> <span class="s1">&#39;tblFalkor_2018 (2).xlsx&#39;</span> <span class="o">-</span><span class="n">S</span> <span class="s1">&#39;Rainier&#39;</span> <span class="o">-</span><span class="n">F</span> <span class="mi">1</span> <span class="o">-</span><span class="n">U</span>
</pre></div>
</div>
<p>Behind the scenes, the script is doing:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Parsing the user supplied arguments.</p></li>
<li><p>Creates <strong>vault/</strong> folder structure, syncs Dropbox, and transfers the files to <strong>vault/</strong>.</p></li>
<li><p>Splitting the data template into data, dataset_metadata and vars_metadata files. Saves metadata as parquet files in /metadata folder.</p></li>
<li><p>Importing into memory the data, dataset_metadata and vars_metadata sheets as pandas dataframes.</p></li>
<li><p>Checks for presence of variables describing organism abundance based on units, short name, and long name. If Org_ID is present in the variable metadata sheet, checks that Conversion_Coefficient aligns with units.</p></li>
<li><p>Checks values in data for outliers (+/- five times standard deviation) or invalid ranges for lat, lon, depth.</p></li>
<li><p>Creating a suggested SQL table and index based on the infered data.</p></li>
<li><p>Insert data into newly created table.</p></li>
<li><p>Insert metadata into various metadata tables, match cruises and classify ocean region(s).</p></li>
<li><p>Create summary stats and insert into tblDataset_Stats.</p></li>
<li><p>Add server alias to tblDataset_Servers.</p></li>
<li><p>Create dataset icon and push to github.</p></li>
</ol>
</div></blockquote>
<p>Once the ingestion completes without any errors, check the catalog to see if the table is visable.
It is also advisable to try to plot one or more variables, download the full datasets, as well as a subset.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See the future code changes section for ideas on improvements.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Norland Raphael Hagen.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>